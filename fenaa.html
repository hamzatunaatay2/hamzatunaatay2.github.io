<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tuna Galeri: Modifiye & High-Speed</title>
<style>
    :root { --bg: #050505; --card: #121212; --gold: #f1c40f; --red: #e74c3c; --green: #2ecc71; --blue: #3498db; }
    body { margin: 0; background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
    
    /* Ãœst Bar */
    .header { background: #000; padding: 15px; display: flex; justify-content: space-around; border-bottom: 2px solid #222; }
    .stat { display: flex; flex-direction: column; align-items: center; font-weight: bold; }
    .bar { width: 80px; height: 8px; background: #333; border-radius: 4px; margin-top: 5px; overflow: hidden; }
    .fill { height: 100%; transition: 0.5s; }

    .main { flex: 1; display: grid; grid-template-columns: 240px 1fr 300px; gap: 15px; padding: 15px; }
    
    /* Sol Nav */
    .nav { display: flex; flex-direction: column; gap: 10px; }
    .nav-btn { background: var(--card); border: 1px solid #333; color: #fff; padding: 15px; border-radius: 10px; cursor: pointer; text-align: left; }
    .nav-btn.active { background: var(--blue); border: none; }

    /* Sahne */
    .stage { background: #000; border-radius: 20px; border: 1px solid #333; position: relative; overflow: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    #npc-ui { text-align: center; width: 85%; }
    .bubble { background: #fff; color: #000; padding: 15px; border-radius: 15px; margin-bottom: 20px; font-weight: bold; position: relative; }
    .bubble::after { content: ''; position: absolute; bottom: -10px; left: 50%; border: 10px solid transparent; border-top-color: #fff; margin-left: -10px; }
    .avatar { font-size: 80px; margin-bottom: 10px; }

    /* SaÄŸ Panel */
    .side { background: var(--card); border-radius: 20px; padding: 20px; border: 1px solid #333; display: flex; flex-direction: column; gap: 10px; }
    .car-box { background: #000; height: 160px; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 70px; border: 1px solid #222; }
    
    .btn { border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; transition: 0.2s; }
    .btn-green { background: var(--green); color: #000; }
    .btn-gold { background: var(--gold); color: #000; }
    .btn-red { background: var(--red); color: #fff; }

    /* 3D */
    #three-canvas { width: 100%; height: 100%; display: none; }
    #drive-ui { position: absolute; top: 20px; color: #fff; text-align: center; display: none; pointer-events: none; }
    #setup { position: absolute; background: rgba(0,0,0,0.95); padding: 30px; border-radius: 20px; border: 2px solid var(--gold); text-align: center; display: none; z-index: 100; }
</style>
</head>
<body>

    <div class="header">
        <div class="stat">ğŸ’° <span id="m-val">500,000</span></div>
        <div class="stat">ğŸ˜« STRES <div class="bar"><div id="s-bar" class="fill" style="background:var(--red); width:0%"></div></div></div>
        <div class="stat">ğŸ•Œ Ä°MAN <div class="bar"><div id="i-bar" class="fill" style="background:var(--blue); width:100%"></div></div></div>
        <div class="stat">ğŸ“… <span id="d-val">Pzt</span></div>
    </div>

    <div class="main">
        <div class="nav">
            <button class="nav-btn active" id="n-galeri" onclick="loc('galeri')">ğŸ¢ GALERÄ°</button>
            <button class="nav-btn" id="n-mahalle" onclick="loc('mahalle')">ğŸ˜ï¸ MAHALLE</button>
            <button class="nav-btn" id="n-sanayi" onclick="loc('sanayi')">ğŸ”§ SANAYÄ°</button>
            <button class="btn btn-red" style="margin-top:auto" onclick="endDay()">ğŸŒ™ GÃœNÃœ BÄ°TÄ°R</button>
        </div>

        <div class="stage">
            <div id="npc-ui">
                <div class="bubble" id="npc-text">"HoÅŸgeldin kral, dÃ¼kkan senin."</div>
                <div class="avatar" id="npc-av">ğŸ¤µ</div>
                <h3 id="npc-name" style="color:var(--gold); margin:0;">Mahmut</h3>
                <div id="actions" style="display:grid; gap:8px; width:260px; margin:20px auto;"></div>
            </div>

            <div id="setup">
                <h2 style="color:var(--gold)">TEST SÃœRÃœÅÃœ</h2>
                <p>HÄ±z Seviyesi:</p>
                <div style="display:flex; gap:10px; margin-bottom:20px;">
                    <button class="btn btn-gold" onclick="setSpd(0.5)">YAVAÅ</button>
                    <button class="btn btn-gold" onclick="setSpd(1.2)">ORTA</button>
                    <button class="btn btn-gold" onclick="setSpd(2.3)">HIZLI</button>
                </div>
                <button class="btn btn-green" style="width:100%" onclick="startDrive()">KONTAÄI Ã‡EVÄ°R</button>
            </div>

            <div id="drive-ui">
                <h1 id="timer">01:00</h1>
                <p>Puan: <span id="score">0</span></p>
            </div>
            <canvas id="three-canvas"></canvas>
        </div>

        <div class="side">
            <h3 style="text-align:center; color:var(--gold); margin:0;">TUNA GALERÄ°</h3>
            <div class="car-box" id="side-icon">ğŸš—</div>
            <h4 id="side-name" style="text-align:center; margin:5px 0;">AraÃ§ Yok</h4>
            <p id="side-price" style="text-align:center; color:#888;">â‚º0</p>
            <div id="side-actions">
                <button class="btn btn-gold" style="width:100%" onclick="findCar()">ğŸš— ARAÃ‡ BUL</button>
            </div>
        </div>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
    // --- ARAÃ‡LAR ---
    const CAR_MODELS = [
        {n:"TofaÅŸ Åahin", p:250000, i:"ğŸš—", c:0xffffff}, {n:"BMW M4", p:6000000, i:"ğŸï¸", c:0x0033ff},
        {n:"Mercedes G63", p:16000000, i:"ğŸšœ", c:0x111111}, {n:"Toros", p:150000, i:"ğŸš—", c:0xdddddd},
        {n:"Ferrari F40", p:40000000, i:"ğŸ", c:0xff0000}, {n:"Egea", p:800000, i:"ğŸš˜", c:0xaaaaaa}
    ];

    let state = { money: 500000, stress: 0, faith: 100, day: 0, car: null, loc: 'galeri', score: 0 };
    let spd = 1.2; let isDriving = false;

    function loc(l) {
        state.loc = l;
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('n-'+l).classList.add('active');
        const acts = document.getElementById('actions'); acts.innerHTML = "";

        if(l==='galeri') {
            setNPC("ğŸ¤µ", "Mahmut", "Araba pÄ±rÄ±l pÄ±rÄ±l usta, teste Ã§Ä±kalÄ±m mÄ±?");
            if(state.car) acts.innerHTML = `<button class="btn btn-gold" onclick="openSetup()">ğŸ TEST SÃœRÃœÅÃœ</button><button class="btn btn-green" onclick="sellMenu()">ğŸ’° MÃœÅTERÄ° BUL</button>`;
        } else if(l==='mahalle') {
            setNPC("ğŸ‘³", "HacÄ± Abi", "Selamun aleykÃ¼m, dÃ¼nya malÄ± yalan...");
            acts.innerHTML = `<button class="btn btn-gold" onclick="pray()">ğŸ•Œ NAMAZ KIL</button>`;
        } else if(l==='sanayi') {
            setNPC("ğŸ‘¨â€ğŸ”§", "Tamirci Sabri", "Usta dÃ¼kkan yoÄŸun ama sana bakarÄ±z. Ne yapalÄ±m?");
            if(state.car) acts.innerHTML = `
                <button class="btn btn-green" onclick="mod('color')">ğŸ¨ RENK DEÄÄ°ÅTÄ°R (â‚º50k)</button>
                <button class="btn btn-gold" onclick="mod('engine')">ğŸš€ MOTOR GÃœÃ‡LENDÄ°R (â‚º200k)</button>
            `;
        }
        updateUI();
    }

    function mod(type) {
        if(type === 'color' && state.money >= 50000) {
            state.money -= 50000; state.car.c = Math.random() * 0xffffff;
            setNPC("ğŸ‘¨â€ğŸ”§", "Sabri", "AteÅŸ ediyor usta, fÄ±stÄ±k gibi oldu!");
        } else if(type === 'engine' && state.money >= 200000) {
            state.money -= 200000; state.car.p += 500000;
            setNPC("ğŸ‘¨â€ğŸ”§", "Sabri", "Bu motorla asfalta yapÄ±ÅŸÄ±rsÄ±n!");
        } else { alert("Para yetersiz!"); }
        updateUI();
    }

    function findCar() {
        const c = CAR_MODELS[Math.floor(Math.random()*CAR_MODELS.length)];
        const p = Math.floor(c.p * (0.9 + Math.random()*0.2));
        setNPC("ğŸ‘¤", "SatÄ±cÄ±", `Bu ${c.n} iÃ§in â‚º${p.toLocaleString()} istiyorum.`);
        document.getElementById('actions').innerHTML = `<button class="btn btn-green" onclick="buy('${c.n}',${p},'${c.i}',${c.c})">SATIN AL</button>`;
    }

    function buy(n,p,i,c) {
        if(state.money >= p) { state.money -= p; state.car = {n,p,i,c}; loc('galeri'); } else alert("Para yetersiz!");
    }

    function sellMenu() {
        const p = Math.floor(state.car.p * (0.8 + Math.random()*0.4));
        setNPC("ğŸ¤", "MÃ¼ÅŸteri", `Bu araca â‚º${p.toLocaleString()} sayarÄ±m. El sÄ±kÄ±ÅŸalÄ±m mÄ±?`);
        document.getElementById('actions').innerHTML = `<button class="btn btn-green" onclick="state.money+=${p}; state.car=null; loc('galeri');">EL SIKIÅ</button>`;
    }

    function pray() { state.faith = 100; state.stress = 0; updateUI(); alert("Huzur buldun..."); }
    function endDay() { state.day++; state.stress = 0; alert("Yeni gÃ¼n, yeni piyasa!"); loc('galeri'); }

    function updateUI() {
        document.getElementById('m-val').innerText = state.money.toLocaleString();
        document.getElementById('s-bar').style.width = state.stress + "%";
        document.getElementById('i-bar').style.width = state.faith + "%";
        document.getElementById('d-val').innerText = ["Pzt","Sal","Ã‡ar","Per","Cum","Cmt","Paz"][state.day % 7];
        if(state.car) {
            document.getElementById('side-icon').innerText = state.car.i;
            document.getElementById('side-name').innerText = state.car.n;
            document.getElementById('side-price').innerText = "â‚º" + state.car.p.toLocaleString();
        }
    }

    function setNPC(a,n,t) { document.getElementById('npc-av').innerText=a; document.getElementById('npc-name').innerText=n; document.getElementById('npc-text').innerText=`"${t}"`; }

    // --- 3D MEKANÄ°K (FULL) ---
    const canvas = document.getElementById('three-canvas');
    const scene = new THREE.Scene(); scene.fog = new THREE.Fog(0, 1, 100);
    const camera = new THREE.PerspectiveCamera(75, 2, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });

    const road = new THREE.Mesh(new THREE.PlaneGeometry(16, 400), new THREE.MeshStandardMaterial({color: 0x111111}));
    road.rotation.x = -Math.PI/2; scene.add(road);
    const lines = [];
    for(let i=0; i<30; i++) {
        let l = new THREE.Mesh(new THREE.PlaneGeometry(0.4, 8), new THREE.MeshBasicMaterial({color:0xffffff}));
        l.rotation.x = -Math.PI/2; l.position.set(0, 0.05, -i*20);
        scene.add(l); lines.push(l);
    }
    
    const player = new THREE.Group();
    function build3D() {
        player.clear();
        const b = new THREE.Mesh(new THREE.BoxGeometry(1.8, 0.7, 3.8), new THREE.MeshStandardMaterial({color: state.car.c}));
        b.position.y = 0.5;
        const l1 = new THREE.SpotLight(0xffffff, 40, 50, 0.5); l1.position.set(0.6, 0.6, -1.8);
        const l2 = new THREE.SpotLight(0xffffff, 40, 50, 0.5); l2.position.set(-0.6, 0.6, -1.8);
        player.add(b, l1, l2, l1.target, l2.target);
    }
    scene.add(player, new THREE.AmbientLight(0xffffff, 0.2));
    camera.position.set(0, 7, 12); camera.lookAt(0, 0, -5);

    let traffic = [];
    function addTraffic() {
        const g = new THREE.Mesh(new THREE.BoxGeometry(1.8, 0.8, 3.5), new THREE.MeshStandardMaterial({color: 0x333333}));
        g.position.set((Math.random()-0.5)*14, 0.5, -150);
        scene.add(g); traffic.push(g);
    }

    function openSetup() { document.getElementById('setup').style.display='block'; }
    function setSpd(s) { spd = s; alert("HÄ±z seÃ§ildi."); }

    function startDrive() {
        document.getElementById('setup').style.display='none'; document.getElementById('npc-ui').style.display='none';
        canvas.style.display='block'; document.getElementById('drive-ui').style.display='block';
        isDriving = true; state.score = 0; build3D(); animate();
    }

    function animate() {
        if(!isDriving) return; requestAnimationFrame(animate);
        lines.forEach(l => { l.position.z += spd * 10; if(l.position.z > 20) l.position.z = -250; });
        if(Math.random() < 0.03) addTraffic();
        traffic.forEach((t, i) => {
            t.position.z += spd * 12;
            if(Math.abs(t.position.z - player.position.z) < 3.5 && Math.abs(t.position.x - player.position.x) < 1.8) {
                isDriving = false; alert("KAZA! Araba hasar aldÄ±."); state.car.p *= 0.7; endDrive();
            }
            if(t.position.z > 20) { scene.remove(t); traffic.splice(i, 1); state.score += 100; }
        });
        document.getElementById('score').innerText = state.score;
        renderer.render(scene, camera);
    }

    function endDrive() {
        isDriving = false; canvas.style.display='none'; 
        document.getElementById('drive-ui').style.display='none';
        document.getElementById('npc-ui').style.display='block';
        traffic.forEach(t => scene.remove(t)); traffic = [];
        loc('galeri');
    }

    window.addEventListener('keydown', (e) => {
        if(!isDriving) return;
        if(e.key === 'a' || e.key === 'ArrowLeft') player.position.x = Math.max(-6, player.position.x - 0.8);
        if(e.key === 'd' || e.key === 'ArrowRight') player.position.x = Math.min(6, player.position.x + 0.8);
        if(e.key === 'Escape') endDrive();
    });

    loc('galeri');
</script>
</body>
</html>
