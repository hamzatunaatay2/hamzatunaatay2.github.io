<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>GTA 7: 2D Chaos Edition</title>
    <style>
        body { margin: 0; background: #111; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        canvas { display: block; cursor: crosshair; }
        #ui {
            position: absolute; top: 20px; right: 20px; text-align: right;
            color: white; text-shadow: 2px 2px #000; pointer-events: none;
        }
        .wanted { color: #f1c40f; font-size: 35px; letter-spacing: 4px; margin: 5px 0; }
        #minimap {
            position: absolute; bottom: 20px; left: 20px;
            width: 150px; height: 150px;
            background: rgba(0,0,0,0.7); border: 3px solid #555;
            border-radius: 10px; overflow: hidden;
        }
        .controls {
            position: absolute; bottom: 20px; right: 20px;
            color: #888; font-size: 12px; background: rgba(0,0,0,0.5); padding: 10px;
        }
    </style>
</head>
<body>

<div id="ui">
    <div id="money" style="color: #2ecc71; font-size: 30px; font-weight: bold;">$0</div>
    <div id="wanted" class="wanted"></div>
    <div id="status" style="font-size: 14px; opacity: 0.8;">Neo-Istanbul Sokakları</div>
</div>

<div id="minimap"><canvas id="mapCanvas"></canvas></div>

<div class="controls">
    WASD: Hareket | E: Araca Bin/İn | <b>MOUSE SOL TIK: ATEŞ ET</b> | R: Restart
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");
const mapCanvas = document.getElementById("mapCanvas");
const mctx = mapCanvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
mapCanvas.width = 150;
mapCanvas.height = 150;

// Oyun Verileri
let player = { x: 200, y: 200, w: 25, h: 25, color: "#3498db", speed: 5, inCar: false };
let car = { x: 500, y: 400, w: 60, h: 35, color: "#f1c40f", speed: 9 };
let bullets = [];
let cops = [];
let moneyBags = [];
let score = 0;
let wantedStars = 0;
let keys = {};

// Giriş Dinleyicileri
window.addEventListener("keydown", e => keys[e.code] = true);
window.addEventListener("keyup", e => keys[e.code] = false);
window.addEventListener("mousedown", shoot);
window.addEventListener("keydown", e => {
    if(e.code === 'KeyE') toggleCar();
    if(e.code === 'KeyR') location.reload();
});

function toggleCar() {
    let dist = Math.hypot(player.x - car.x, player.y - car.y);
    if (!player.inCar && dist < 60) {
        player.inCar = true;
        if(wantedStars < 1) wantedStars = 1;
    } else if (player.inCar) {
        player.inCar = false;
        player.x = car.x + 70;
    }
}

function shoot(e) {
    if(player.inCar) return;
    const angle = Math.atan2(e.clientY - player.y, e.clientX - player.x);
    bullets.push({ x: player.x + 12, y: player.y + 12, vx: Math.cos(angle) * 12, vy: Math.sin(angle) * 12 });
}

function spawnMoney() {
    if(Math.random() < 0.02) {
        moneyBags.push({ x: Math.random() * canvas.width, y: Math.random() * canvas.height, size: 15 });
    }
}

function update() {
    let target = player.inCar ? car : player;
    let speed = player.inCar ? car.speed : player.speed;

    if (keys['KeyW']) target.y -= speed;
    if (keys['KeyS']) target.y += speed;
    if (keys['KeyA']) target.x -= speed;
    if (keys['KeyD']) target.x += speed;

    if(player.inCar) { player.x = car.x; player.y = car.y; }

    // Mermi Hareket ve Çatışma
    bullets.forEach((b, bi) => {
        b.x += b.vx; b.y += b.vy;
        cops.forEach((cop, ci) => {
            if(Math.hypot(b.x - cop.x, b.y - cop.y) < 20) {
                cops.splice(ci, 1);
                bullets.splice(bi, 1);
                score += 100;
                wantedStars = Math.min(5, wantedStars + 1);
            }
        });
    });

    // Para Toplama
    moneyBags.forEach((m, i) => {
        if(Math.hypot(target.x - m.x, target.y - m.y) < 30) {
            moneyBags.splice(i, 1);
            score += 500;
        }
    });

    // Polis Mantığı
    if(wantedStars > 0) {
        if(Math.random() < 0.01 * wantedStars && cops.length < wantedStars * 3) {
            cops.push({x: Math.random()*canvas.width, y: -20, speed: 2 + wantedStars/2});
        }
        cops.forEach(cop => {
            let dx = target.x - cop.x;
            let dy = target.y - cop.y;
            let angle = Math.atan2(dy, dx);
            cop.x += Math.cos(angle) * cop.speed;
            cop.y += Math.sin(angle) * cop.speed;

            if(Math.hypot(target.x - cop.x, target.y - cop.y) < 20) {
                alert("BUSTED! Toplanan Para: $" + score);
                location.reload();
            }
        });
    }

    spawnMoney();
    document.getElementById("money").innerText = "$" + score;
    document.getElementById("wanted").innerText = "★".repeat(wantedStars);
}

function drawMinimap() {
    mctx.fillStyle = "rgba(0,0,0,0.8)";
    mctx.fillRect(0, 0, 150, 150);
    
    const scale = 150 / Math.max(canvas.width, canvas.height);
    
    mctx.fillStyle = "white"; // Oyuncu
    mctx.fillRect(player.x * scale, player.y * scale, 5, 5);
    
    mctx.fillStyle = "yellow"; // Araba
    mctx.fillRect(car.x * scale, car.y * scale, 8, 5);
    
    mctx.fillStyle = "red"; // Polisler
    cops.forEach(c => mctx.fillRect(c.x * scale, c.y * scale, 4, 4));
}

function draw() {
    ctx.fillStyle = "#222";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Yol Çizimi
    ctx.fillStyle = "#333";
    ctx.fillRect(0, canvas.height/2 - 100, canvas.width, 200);

    // Paralar
    moneyBags.forEach(m => {
        ctx.fillStyle = "#2ecc71";
        ctx.beginPath();
        ctx.arc(m.x, m.y, 8, 0, Math.PI*2);
        ctx.fill();
        ctx.fillStyle = "white";
        ctx.fillText("$", m.x-3, m.y+4);
    });

    // Araba
    ctx.fillStyle = car.color;
    ctx.fillRect(car.x, car.y, car.w, car.h);

    // Oyuncu
    if(!player.inCar) {
        ctx.fillStyle = player.color;
        ctx.fillRect(player.x, player.y, player.w, player.h);
        // Silah Görseli (Basit hat)
        ctx.fillStyle = "#7f8c8d";
        ctx.fillRect(player.x + 10, player.y + 10, 15, 5);
    }

    // Mermiler
    ctx.fillStyle = "yellow";
    bullets.forEach(b => ctx.fillRect(b.x, b.y, 4, 4));

    // Polisler
    cops.forEach(cop => {
        ctx.fillStyle = "#2980b9";
        ctx.fillRect(cop.x, cop.y, 25, 25);
        ctx.fillStyle = Math.random() > 0.5 ? "red" : "blue";
        ctx.fillRect(cop.x, cop.y - 10, 25, 5);
    });

    update();
    drawMinimap();
    requestAnimationFrame(draw);
}

draw();
</script>
</body>
</html>
