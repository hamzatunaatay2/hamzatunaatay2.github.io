<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Halvior AI</title>

<!-- PWA -->
<link rel="manifest" id="manifest">

<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #0f172a;
    color: white;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
}
.chat-container {
    width: 500px;
    height: 700px;
    background-color: #1e293b;
    border-radius: 25px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.6);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    border: 1px solid #334155;
}
.header {
    background: linear-gradient(90deg, #3b82f6, #8b5cf6);
    padding: 20px;
    text-align: center;
    font-weight: bold;
    font-size: 1.4rem;
}
.messages-area {
    flex: 1;
    padding: 20px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 12px;
}
.message {
    max-width: 85%;
    padding: 12px 16px;
    border-radius: 18px;
    font-size: 0.95rem;
}
.bot-message { background:#334155; align-self:flex-start; }
.user-message { background:#3b82f6; align-self:flex-end; }
.loading { color:#94a3b8; font-style:italic; }
.input-area {
    padding: 20px;
    background-color: #0f172a;
    display: flex;
    gap: 10px;
}
input {
    flex: 1;
    padding: 12px 20px;
    border-radius: 30px;
    border: 1px solid #334155;
    background-color: #1e293b;
    color: white;
    outline: none;
}
button {
    background: #3b82f6;
    border: none;
    color: white;
    padding: 10px 25px;
    border-radius: 30px;
    cursor: pointer;
}
</style>
</head>

<body>
<div class="chat-container">
    <div class="header">âœ¨ HALVIOR AI</div>
    <div class="messages-area" id="messageBox">
        <div class="message bot-message">Selam knk! Ben Halvior ðŸ˜Ž</div>
    </div>
    <div class="input-area">
        <input id="userInput" placeholder="Bir ÅŸey yaz..." onkeypress="handleEnter(event)">
        <button onclick="sendMessage()">GÃ¶nder</button>
    </div>
</div>

<script>
/* =====================
   PWA MANIFEST
===================== */
const manifest = {
  name: "Halvior AI",
  short_name: "Halvior",
  start_url: ".",
  display: "standalone",
  background_color: "#0f172a",
  theme_color: "#3b82f6"
};
const blob = new Blob([JSON.stringify(manifest)], {type:"application/json"});
document.getElementById("manifest").href = URL.createObjectURL(blob);

/* =====================
   SETTINGS
===================== */
const USE_CHATGPT = false; // true yaparsan API kullanÄ±r
const OPENAI_KEY = "BURAYA_KEY"; // opsiyonel

/* =====================
   HAFIZA
===================== */
let memory = JSON.parse(localStorage.getItem("halviorMemory")) || {};

/* =====================
   BEYIN
===================== */
const brain = {
  "merhaba":"Selam knk!",
  "selam":"Selam ðŸ˜„",
  "nasilsin":"Bomba gibiyim, sen?",
  "iyiyim":"SÃ¼per ðŸ”¥",
  "kotuyum":"ÃœzdÃ¼ knkâ€¦ anlat istersen",
  "espri":"ProgramcÄ± neden aynaya bakmaz? Bug gÃ¶rÃ¼r ðŸ˜‚",
  "default":"Bunu bilmiyorum ama Ã¶ÄŸretebilirsin ðŸ‘€"
};

/* =====================
   UTILS
===================== */
function normalize(t){
  return t.toLowerCase()
  .replace(/Ä±/g,"i").replace(/ÄŸ/g,"g")
  .replace(/Ã¼/g,"u").replace(/ÅŸ/g,"s")
  .replace(/Ã¶/g,"o").replace(/Ã§/g,"c");
}

function addMessage(text, cls){
  const box = messageBox;
  const div = document.createElement("div");
  div.classList.add("message");
  cls.split(" ").forEach(c=>div.classList.add(c));
  div.innerText = text;
  box.appendChild(div);
  box.scrollTop = box.scrollHeight;
  return div;
}

function typeMessage(text){
  const div = document.createElement("div");
  div.classList.add("message","bot-message");
  messageBox.appendChild(div);
  let i=0;
  const it = setInterval(()=>{
    div.innerText += text[i];
    if(++i >= text.length) {
      clearInterval(it);
      speak(text);
    }
    messageBox.scrollTop = messageBox.scrollHeight;
  },25);
}

/* =====================
   SESLI KONUSMA
===================== */
function speak(text){
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "tr-TR";
  speechSynthesis.speak(u);
}

const rec = window.SpeechRecognition || window.webkitSpeechRecognition;
let recognition;
if(rec){
  recognition = new rec();
  recognition.lang = "tr-TR";
  recognition.onresult = e=>{
    userInput.value = e.results[0][0].transcript;
    sendMessage();
  };
}

// V basÄ±lÄ± tut â†’ konuÅŸ
document.addEventListener("keydown",e=>{
  if(e.key==="v" && recognition) recognition.start();
});
document.addEventListener("keyup",e=>{
  if(e.key==="v" && recognition) recognition.stop();
});

/* =====================
   AI
===================== */
function findReply(text){
  if(memory[text]) return memory[text];

  for(let k in brain)
    if(text.includes(k)) return brain[k];

  if(text.startsWith("ogret:")){
    const p=text.replace("ogret:","").split("=");
    if(p.length===2){
      memory[p[0].trim()] = p[1].trim();
      localStorage.setItem("halviorMemory",JSON.stringify(memory));
      return "Tamam knk Ã¶ÄŸrendim âœ…";
    }
    return "Format: ogret: soru = cevap";
  }

  return brain.default;
}

/* =====================
   SEND
===================== */
function sendMessage(){
  const t = userInput.value.trim();
  if(!t) return;
  addMessage(t,"user-message");
  userInput.value="";
  const l = addMessage("DÃ¼ÅŸÃ¼nÃ¼yorum...","bot-message loading");
  setTimeout(()=>{
    l.remove();
    typeMessage(findReply(normalize(t)));
  },800);
}
function handleEnter(e){ if(e.key==="Enter") sendMessage(); }
</script>
</body>
</html>
