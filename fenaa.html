<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>GTA 7 - 2D Mafia Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #222; font-family: sans-serif; }
        canvas { display: block; background: #333; }
        #ui { position: absolute; top: 10px; left: 10px; color: white; background: rgba(0,0,0,0.5); padding: 10px; pointer-events: none; }
    </style>
</head>
<body>

<div id="ui">
    <strong>GTA 7 - MAFYA MODU</strong><br>
    Hareket: Ok Tuşları / WASD<br>
    Ateş: BOŞLUK (Space)<br>
    Araba Bin/İn: E<br>
    Durum: <span id="status">Yaya</span>
</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const statusEl = document.getElementById('status');

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let player = { x: 100, y: 100, w: 20, h: 20, speed: 4, inCar: false, carIndex: -1 };
let bullets = [];
let npcs = [];
let cars = [
    { x: 300, y: 200, w: 60, h: 30, color: 'yellow' },
    { x: 500, y: 400, w: 60, h: 30, color: 'orange' }
];

// NPC Oluştur
for(let i=0; i<8; i++) {
    npcs.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, r: 10, dead: false });
}

let keys = {};
window.addEventListener('keydown', e => {
    keys[e.code] = true;
    if(e.code === 'KeyE') toggleCar();
    if(e.code === 'Space' && !player.inCar) shoot();
});
window.addEventListener('keyup', e => keys[e.code] = false);

function toggleCar() {
    if(!player.inCar) {
        cars.forEach((car, index) => {
            let dist = Math.hypot(player.x - car.x, player.y - car.y);
            if(dist < 50) {
                player.inCar = true;
                player.carIndex = index;
                statusEl.innerText = "Direksiyonda";
            }
        });
    } else {
        player.inCar = false;
        player.y += 40; // Arabadan aşağı in
        statusEl.innerText = "Yaya";
    }
}

function shoot() {
    bullets.push({ x: player.x + 10, y: player.y + 10, vx: 10, vy: 0 });
}

function update() {
    let speed = player.inCar ? 8 : 4;
    
    if(keys['ArrowUp'] || keys['KeyW']) player.y -= speed;
    if(keys['ArrowDown'] || keys['KeyS']) player.y += speed;
    if(keys['ArrowLeft'] || keys['KeyA']) player.x -= speed;
    if(keys['ArrowRight'] || keys['KeyD']) player.x += speed;

    if(player.inCar) {
        cars[player.carIndex].x = player.x;
        cars[player.carIndex].y = player.y;
    }

    // Mermileri hareket ettir ve NPC vurma kontrolü
    bullets.forEach((b, bi) => {
        b.x += b.vx;
        npcs.forEach(n => {
            if(!n.dead && Math.hypot(b.x - n.x, b.y - n.y) < 15) {
                n.dead = true;
                bullets.splice(bi, 1);
            }
        });
    });
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Arabalar
    cars.forEach(car => {
        ctx.fillStyle = car.color;
        ctx.fillRect(car.x, car.y, car.w, car.h);
    });

    // NPC'ler
    npcs.forEach(n => {
        if(!n.dead) {
            ctx.fillStyle = 'red';
            ctx.beginPath();
            ctx.arc(n.x, n.y, n.r, 0, Math.PI*2);
            ctx.fill();
        }
    });

    // Mermiler
    ctx.fillStyle = 'white';
    bullets.forEach(b => ctx.fillRect(b.x, b.y, 5, 2));

    // Oyuncu
    if(!player.inCar) {
        ctx.fillStyle = '#00f';
        ctx.fillRect(player.x, player.y, player.w, player.h);
    }

    requestAnimationFrame(() => {
        update();
        draw();
    });
}

draw();
</script>
</body>
</html>
