<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halvior AI - Pro</title>
    <style>
        :root { --bg: #020617; --card: #0f172a; --accent: #c084fc; --neon: #22d3ee; --text: #f1f5f9; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background: var(--bg); color: var(--text); display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        #app { width: 100%; max-width: 550px; height: 85vh; background: var(--card); border-radius: 30px; display: flex; flex-direction: column; border: 1px solid #1e293b; box-shadow: 0 0 60px rgba(192, 132, 252, 0.15); overflow: hidden; }
        .header { padding: 20px; background: rgba(30, 41, 59, 0.5); border-bottom: 1px solid #334155; text-align: center; }
        .header h1 { margin: 0; font-size: 1.4rem; letter-spacing: 4px; color: var(--accent); text-transform: uppercase; }
        #chat { flex: 1; padding: 25px; overflow-y: auto; display: flex; flex-direction: column; gap: 15px; }
        .m { padding: 14px 18px; border-radius: 20px; max-width: 80%; font-size: 15px; line-height: 1.6; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .u { background: var(--accent); color: #1e1b4b; align-self: flex-end; border-bottom-right-radius: 4px; font-weight: 500; }
        .a { background: #1e293b; align-self: flex-start; border-bottom-left-radius: 4px; border: 1px solid #334155; box-shadow: 3px 3px 10px rgba(0,0,0,0.2); }
        .controls { padding: 20px; background: #0f172a; display: flex; gap: 12px; border-top: 1px solid #334155; }
        input { flex: 1; padding: 14px; border: none; border-radius: 15px; background: #020617; color: white; outline: none; border: 1px solid #334155; }
        .btn { padding: 12px 20px; border-radius: 15px; border: none; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-send { background: var(--accent); color: #1e1b4b; }
        .btn-mic { background: #1e293b; font-size: 20px; border: 1px solid #334155; }
        .active-mic { background: #ef4444 !important; animation: pulse 1s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.6; } 100% { opacity: 1; } }
        .tts-link { color: var(--neon); font-size: 11px; cursor: pointer; display: block; margin-top: 8px; text-decoration: none; opacity: 0.8; }
    </style>
</head>
<body>

<div id="app">
    <div class="header"><h1>Halvior AI <small style="font-size: 10px; opacity: 0.5;">v4.0 PRO</small></h1></div>
    <div id="chat"></div>
    <div class="controls">
        <button id="micBtn" class="btn btn-mic" onclick="startVoice()">ðŸŽ¤</button>
        <input type="text" id="userInput" placeholder="Halvior ile konuÅŸ..." onkeypress="if(event.key=='Enter') handleAction()">
        <button class="btn btn-send" onclick="handleAction()">GÃ–NDER</button>
    </div>
</div>

<script>
    const chat = document.getElementById("chat");
    const input = document.getElementById("userInput");
    
    // --- BEYÄ°N VE HAFIZA ---
    let lastMsg = "";
    let spamCount = 0;

    const responses = {
        "merhaba": ["Selam knk, hoÅŸ geldin!", "Merhaba! BugÃ¼n ne yapÄ±yoruz?", "Ooo kral selamlar."],
        "nasÄ±lsÄ±n": ["Veri akÄ±ÅŸÄ±m tÄ±kÄ±rÄ±nda, bomba gibiyim! Sen nasÄ±lsÄ±n?", "Ä°yiyim knk, devreleri yeni yaÄŸladÄ±m.", "Seni gÃ¶rdÃ¼m daha iyi oldum."],
        "kimsin": ["Ben Halvior AI. Senin iÃ§in geliÅŸtirilmiÅŸ, internet destekli bir yapay zekayÄ±m.", "Senin dijital kankanÄ±m!"],
        "teÅŸekkÃ¼r": ["Ne demek knk, gÃ¶revimiz.", "LafÄ± bile olmaz, Halvior her zaman yanÄ±nda."],
        "sa": ["AleykÃ¼mselam kral, hoÅŸ geldin!", "Selam, naber?"],
        "spam_uyari": ["Knk aynÄ± ÅŸeyi sÃ¶yleyip durma, kafam karÄ±ÅŸÄ±yor!", "Tamam anladÄ±k, spam atma artÄ±k...", "Devrelerimi yakmaya mÄ± Ã§alÄ±ÅŸÄ±yorsun? BaÅŸka bir ÅŸey yaz!"]
    };

    // --- SES MOTORU ---
    function talk(text) {
        window.speechSynthesis.cancel();
        const speech = new SpeechSynthesisUtterance(text);
        speech.lang = 'tr-TR';
        window.speechSynthesis.speak(speech);
    }

    // --- SES TANIMA (MÄ°KROFON) ---
    function startVoice() {
        if (!('webkitSpeechRecognition' in window)) return alert("TarayÄ±cÄ±n desteklemiyor!");
        const rec = new webkitSpeechRecognition();
        rec.lang = 'tr-TR';
        rec.onstart = () => document.getElementById("micBtn").classList.add("active-mic");
        rec.onend = () => document.getElementById("micBtn").classList.remove("active-mic");
        rec.onresult = (e) => {
            input.value = e.results[0][0].transcript;
            handleAction();
        };
        rec.start();
    }

    // --- ANA MANTIK ---
    async function handleAction() {
        const val = input.value.trim();
        if (!val) return;

        // SPAM KONTROLÃœ
        if (val.toLowerCase() === lastMsg.toLowerCase()) {
            spamCount++;
        } else {
            spamCount = 0;
            lastMsg = val;
        }

        addMsg(val, 'u');
        input.value = "";

        if (spamCount >= 2) {
            const spamReply = responses.spam_uyari[Math.floor(Math.random() * responses.spam_uyari.length)];
            setTimeout(() => {
                addMsg(spamReply, 'a');
                talk(spamReply);
            }, 500);
            return;
        }

        // BEYÄ°N SORGUSU
        let reply = "";
        const lower = val.toLowerCase();

        for (let key in responses) {
            if (lower.includes(key) && key !== "spam_uyari") {
                reply = responses[key][Math.floor(Math.random() * responses[key].length)];
            }
        }

        // WIKI SORGUSU
        if (!reply || lower.includes("nedir") || lower.includes("ara")) {
            const q = lower.replace("nedir", "").replace("ara", "").trim();
            if (q.length > 2) {
                addMsg("Halvior internette derin araÅŸtÄ±rmalar yapÄ±yor...", 'a');
                const info = await fetchWiki(q);
                updateLastBot(info);
                talk(info);
                return;
            }
        }

        if (!reply) reply = "Bunu tam anlayamadÄ±m knk. 'nedir [konu]' yazarsan internetten bakabilirim.";
        
        setTimeout(() => {
            addMsg(reply, 'a');
            talk(reply);
        }, 600);
    }

    function addMsg(t, c) {
        const d = document.createElement("div");
        d.className = `m ${c}`;
        d.innerHTML = t;
        if(c === 'a') d.innerHTML += `<a class="tts-link" onclick="talk('${t.replace(/'/g,"")}')">ðŸ”Š Tekrar Dinle</a>`;
        chat.appendChild(d);
        chat.scrollTop = chat.scrollHeight;
    }

    function updateLastBot(t) {
        const bots = document.querySelectorAll(".a");
        const last = bots[bots.length - 1];
        last.innerHTML = `<b>Halvior Bilgi Merkezi:</b><br>${t}<a class="tts-link" onclick="talk('${t.replace(/'/g,"")}')">ðŸ”Š Dinle</a>`;
        chat.scrollTop = chat.scrollHeight;
    }

    async function fetchWiki(q) {
        try {
            const r = await fetch(`https://tr.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(q)}`);
            const d = await r.json();
            return d.extract || "Bunun hakkÄ±nda veri bulamadÄ±m knk, baÅŸka bir ÅŸey sor.";
        } catch { return "BaÄŸlantÄ± hatasÄ±! Ä°nterneti kontrol et."; }
    }

    window.onload = () => addMsg("Halvior AI v4.0 PRO Sistemleri aktif. Dinliyorum kral!", 'a');
</script>

</body>
</html>
