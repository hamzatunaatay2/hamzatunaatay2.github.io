<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Tuna Galeri: Underground King</title>
<style>
    :root { --neon: #00f2ff; --pink: #ff007f; --gold: #ffd700; --bg: #050505; }
    body { margin: 0; background: var(--bg); color: #fff; font-family: 'Orbitron', sans-serif; overflow: hidden; }
    
    /* HUD & UI */
    .game-ui { position: fixed; width: 100%; height: 100%; pointer-events: none; z-index: 10; display: flex; flex-direction: column; justify-content: space-between; padding: 30px; box-sizing: border-box; }
    .top-stats { display: flex; gap: 20px; pointer-events: all; }
    .stat-box { background: rgba(0,0,0,0.8); border: 1px solid var(--neon); padding: 15px; border-radius: 5px; box-shadow: 0 0 15px var(--neon); }
    
    /* Center Stage */
    .main-container { display: flex; height: 100vh; padding: 20px; gap: 20px; }
    .sidebar { width: 300px; background: rgba(15,15,15,0.9); border: 1px solid #333; padding: 20px; pointer-events: all; border-radius: 15px; }
    .viewport { flex: 1; background: #000; border-radius: 20px; border: 2px solid #222; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; }

    /* Dialog System */
    .dialog-panel { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); width: 80%; background: rgba(0,0,0,0.9); border: 2px solid var(--pink); padding: 20px; border-radius: 10px; display: none; text-align: center; }
    .npc-name { color: var(--pink); font-weight: bold; margin-bottom: 10px; font-size: 20px; }

    /* Buttons */
    .btn { background: #222; border: 1px solid var(--neon); color: var(--neon); padding: 12px; cursor: pointer; font-family: 'Orbitron'; transition: 0.3s; width: 100%; margin-bottom: 10px; }
    .btn:hover { background: var(--neon); color: #000; box-shadow: 0 0 20px var(--neon); }
    .btn-action { border-color: var(--pink); color: var(--pink); }
    .btn-action:hover { background: var(--pink); color: #000; box-shadow: 0 0 20px var(--pink); }

    /* Speedo */
    #speedo { position: absolute; bottom: 30px; right: 30px; color: var(--neon); text-align: right; display: none; }
    canvas { width: 100%; height: 100%; display: none; }
</style>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

<div class="game-ui">
    <div class="top-stats">
        <div class="stat-box">ğŸ’° PARA: <span id="u-money">500,000</span>â‚º</div>
        <div class="stat-box">ğŸ”¥ STRES: %<span id="u-stress">0</span></div>
        <div class="stat-box">ğŸ•Œ Ä°MAN: %<span id="u-faith">100</span></div>
    </div>
</div>

<div class="main-container">
    <div class="sidebar">
        <h2 style="color:var(--neon); text-align:center;">TUNA GARAJ</h2>
        <div id="active-car-info" style="margin-bottom: 20px;">
            <div style="font-size:50px; text-align:center;" id="c-icon">ğŸ¢</div>
            <h3 id="c-name" style="text-align:center; color:var(--pink);">AraÃ§ Yok</h3>
            <p id="c-stats" style="font-size:12px; text-align:center; color:#888;">HÄ±z: 0 | Yol TutuÅŸ: 0</p>
        </div>
        <hr border="1" color="#333">
        <button class="btn" onclick="setLoc('galeri')">ğŸ¢ GALERÄ°</button>
        <button class="btn" onclick="setLoc('sanayi')">ğŸ”§ SANAYÄ° (TUNING)</button>
        <button class="btn" onclick="setLoc('mahalle')">ğŸ˜ï¸ MAHALLE</button>
        <button class="btn btn-action" onclick="findCar()">ğŸš— ARAÃ‡ KOVALA</button>
        <button class="btn btn-action" onclick="startDrive()" id="drive-btn" style="display:none">ğŸï¸ TESTE Ã‡IK</button>
    </div>

    <div class="viewport" id="viewport">
        <div class="dialog-panel" id="dialog">
            <div class="npc-name" id="npc-name">Mahmut</div>
            <div class="npc-text" id="npc-text">"Piyasada mal kalmadÄ± usta, yeni araÃ§lar bakmamÄ±z lazÄ±m."</div>
            <div id="dialog-options" style="margin-top:15px; display:flex; gap:10px; justify-content:center;"></div>
        </div>
        <div id="speedo">
            <h1 id="kmh" style="margin:0; font-size:60px;">0</h1>
            <span>KM/H</span>
        </div>
        <canvas id="game-canvas"></canvas>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
    let state = { money: 500000, stress: 0, faith: 100, car: null, loc: 'galeri' };
    let isDriving = false;
    let driveSpeed = 0;
    let targetSpeed = 0;
    let carX = 0;
    let shake = 0;

    // --- LOGIC ---
    function setLoc(l) {
        state.loc = l;
        const dialog = document.getElementById('dialog');
        const options = document.getElementById('dialog-options');
        dialog.style.display = 'block';
        options.innerHTML = "";

        if(l === 'galeri') {
            setNPC("MAHMUT", "DÃ¼kkan senin kral. Ã‡ay taze, araba varsa piste geÃ§elim.");
            if(state.car) document.getElementById('drive-btn').style.display = 'block';
        } else if(l === 'sanayi') {
            setNPC("USTA SABRÄ°", "Turbo mu takalÄ±m, basÄ±k mÄ± olsun? MalÄ±n deÄŸerini katlayalÄ±m.");
            if(state.car) {
                options.innerHTML = `
                    <button class="btn" onclick="tune('turbo')">ğŸš€ TURBO (100k)</button>
                    <button class="btn" onclick="tune('susp')">ğŸ“‰ BASIKLIK (50k)</button>
                `;
            }
        } else if(l === 'mahalle') {
            setNPC("HACI AMCA", "Gel bi' abdest alalÄ±m, kafan daÄŸÄ±lÄ±r.");
            options.innerHTML = `<button class="btn" onclick="pray()">ğŸ•Œ HUZUR BUL</button>`;
        }
    }

    function tune(type) {
        if(type === 'turbo' && state.money >= 100000) {
            state.money -= 100000; state.car.speedStat += 2; state.car.p += 200000;
            setNPC("SABRÄ°", "Turbo Ä±slÄ±k Ã§alÄ±yor usta! UÃ§acaksÄ±n.");
        } else if(type === 'susp' && state.money >= 50000) {
            state.money -= 50000; state.car.gripStat += 2; state.car.p += 80000;
            setNPC("SABRÄ°", "AraÃ§ yere yapÄ±ÅŸtÄ±, virajÄ±n kralÄ±sÄ±n artÄ±k.");
        }
        updateUI();
    }

    function findCar() {
        const models = [
            {n:"S2000", p:2500000, i:"ğŸï¸", c:0xeeeeee, s:3, g:3},
            {n:"Supra", p:8000000, i:"ğŸ‰", c:0xffaa00, s:5, g:4},
            {n:"Åahin S", p:knk bu benden sana hediye olsun, i:"ğŸš—", c:0xffffff, s:1, g:1},
            {n:"M3 E46", p:3500000, i:"ğŸ”¥", c:0x0033ff, s:4, g:3}
        ];
        const c = models[Math.floor(Math.random()*models.length)];
        const price = Math.floor(c.p * (0.9 + Math.random()*0.3));
        
        setLoc('galeri');
        setNPC("GALERÄ°CÄ°", `${c.n} geldi. â‚º${price.toLocaleString()} olur.`);
        document.getElementById('dialog-options').innerHTML = `
            <button class="btn" onclick="buyCar('${c.n}',${price},'${c.i}',${c.c},${c.s},${c.g})">ALDIM</button>
            <button class="btn" onclick="setLoc('galeri')">GEÃ‡</button>
        `;
    }

    function buyCar(n,p,i,c,s,g) {
        if(state.money >= p) {
            state.money -= p;
            state.car = {n, p, i, c, speedStat: s, gripStat: g};
            updateUI();
            setLoc('galeri');
        } else alert("Para yetersiz!");
    }

    function pray() { state.faith = 100; state.stress = 0; updateUI(); setNPC("HACI", "Allah kabul etsin..."); }

    function updateUI() {
        document.getElementById('u-money').innerText = state.money.toLocaleString();
        document.getElementById('u-stress').innerText = state.stress;
        document.getElementById('u-faith').innerText = state.faith;
        if(state.car) {
            document.getElementById('c-name').innerText = state.car.n;
            document.getElementById('c-icon').innerText = state.car.i;
            document.getElementById('c-stats').innerText = `HÄ±z: ${state.car.speedStat} | Yol TutuÅŸ: ${state.car.gripStat}`;
            document.getElementById('drive-btn').style.display = 'block';
        }
    }

    function setNPC(n, t) {
        document.getElementById('npc-name').innerText = n;
        document.getElementById('npc-text').innerText = `"${t}"`;
    }

    // --- ARCADE 3D ENGINE ---
    const canvas = document.getElementById('game-canvas');
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, canvas.clientWidth/canvas.clientHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });

    // Yol (GeliÅŸmiÅŸ Neon GÃ¶rÃ¼nÃ¼m)
    const roadG = new THREE.PlaneGeometry(20, 1000);
    const roadM = new THREE.MeshStandardMaterial({ color: 0x050505 });
    const road = new THREE.Mesh(roadG, roadM);
    road.rotation.x = -Math.PI/2;
    scene.add(road);

    const lights = [];
    for(let i=0; i<20; i++) {
        const l = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.1, 10), new THREE.MeshBasicMaterial({color: var(--neon)}));
        l.position.set(0, 0.1, -i*50);
        scene.add(l); lights.push(l);
    }

    const playerCar = new THREE.Group();
    scene.add(playerCar);
    scene.add(new THREE.AmbientLight(0xffffff, 0.4));
    const spot = new THREE.PointLight(0xff007f, 2, 50);
    playerCar.add(spot);

    function startDrive() {
        isDriving = true;
        canvas.style.display = 'block';
        document.getElementById('speedo').style.display = 'block';
        document.getElementById('dialog').style.display = 'none';
        
        // ArabayÄ± Ä°nÅŸa Et
        playerCar.clear();
        const body = new THREE.Mesh(new THREE.BoxGeometry(2, 0.8, 4), new THREE.MeshStandardMaterial({color: state.car.c}));
        body.position.y = 0.5;
        playerCar.add(body);
        
        targetSpeed = state.car.speedStat * 1.5;
        animate();
    }

    function animate() {
        if(!isDriving) return;
        requestAnimationFrame(animate);

        // Ä°vmelenme ve HÄ±zlanma
        driveSpeed = THREE.MathUtils.lerp(driveSpeed, targetSpeed, 0.05);
        
        // Yol akÄ±ÅŸÄ±
        lights.forEach(l => {
            l.position.z += driveSpeed * 10;
            if(l.position.z > 50) l.position.z = -800;
        });

        // Kamera Sallanma (HÄ±z Efekti)
        shake = (Math.random() - 0.5) * (driveSpeed * 0.05);
        camera.position.set(shake, 6, 12);
        camera.lookAt(playerCar.position.x, 0, -10);

        // Vites Atma SimÃ¼lasyonu (FOV deÄŸiÅŸimi)
        camera.fov = 70 + (driveSpeed * 5);
        camera.updateProjectionMatrix();

        document.getElementById('kmh').innerText = Math.floor(driveSpeed * 60);
        renderer.render(scene, camera);
    }

    window.addEventListener('keydown', (e) => {
        if(!isDriving) return;
        const step = 0.1 * state.car.gripStat;
        if(e.key === 'a') playerCar.position.x -= step;
        if(e.key === 'd') playerCar.position.x += step;
        if(e.key === 'Escape') {
            isDriving = false;
            canvas.style.display = 'none';
            document.getElementById('speedo').style.display = 'none';
            setLoc('galeri');
        }
    });

    setLoc('galeri');
</script>
</body>
</html>
