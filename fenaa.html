<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>GTA 7: Definitive 2D Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #222; font-family: 'Segoe UI', sans-serif; }
        #ui { position: absolute; top: 20px; left: 20px; color: white; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 10px; border: 2px solid #555; pointer-events: none; }
        #dialog { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); width: 60%; background: rgba(0,0,0,0.9); color: #0f0; padding: 20px; border: 2px solid #0f0; border-radius: 5px; display: none; }
        #mission { color: #ffff00; font-weight: bold; font-size: 1.2em; }
        #health { width: 200px; height: 10px; background: #300; border: 1px solid #fff; }
        #health-bar { width: 100%; height: 100%; background: #f00; }
        canvas { display: block; cursor: crosshair; }
    </style>
</head>
<body>

<div id="ui">
    <div id="mission">GÃ–REV: Tony'nin yanÄ±na git (KÄ±rmÄ±zÄ± NPC)</div>
    <div id="stats">ğŸ’° Para: $<span id="money">0</span> | â­ <span id="wanted">0</span></div>
    SAÄLIK: <div id="health"><div id="health-bar"></div></div>
    <small>WASD: Hareket | Mouse: NiÅŸan & AteÅŸ | E: Bin/Ä°n | F: KonuÅŸ</small>
</div>

<div id="dialog">Tony: "Hey evlat! Åu karÅŸÄ±daki sarÄ± arabayÄ± Ã§al ve limana gÃ¶tÃ¼r."</div>

<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// --- OYUN AYARLARI ---
let player = { x: 500, y: 500, angle: 0, speed: 0, maxSpeed: 4, inCar: false, car: null, health: 100, money: 0, wanted: 0 };
let mouse = { x: 0, y: 0 };
let bullets = [];
let npcs = [{ x: 600, y: 400, angle: 0, color: 'red', name: 'Tony', dialog: 'Tony: "Daha ne bekliyorsun? Ã‡al ÅŸu arabayÄ±!"', missionTrigger: true }];
let cars = [{ x: 800, y: 300, angle: 0, speed: 0, color: '#f1c40f', locked: false }];
let buildings = [{x: 200, y: 200, w: 150, h: 150, color: '#444'}];
let camera = { x: 0, y: 0 };
let currentMission = 0;

// --- GÄ°RDÄ°LER ---
let keys = {};
window.onkeydown = e => { 
    keys[e.code] = true; 
    if(e.code === 'KeyE') toggleCar();
    if(e.code === 'KeyF') talkToNPC();
};
window.onkeyup = e => keys[e.code] = false;
window.onmousemove = e => { mouse.x = e.clientX + camera.x; mouse.y = e.clientY + camera.y; };
window.onmousedown = () => { if(!player.inCar) shoot(); };

function toggleCar() {
    if(player.inCar) {
        player.inCar = false;
        player.car.speed = 0;
        player.y += 60;
        player.car = null;
    } else {
        cars.forEach(c => {
            if(Math.hypot(player.x - c.x, player.y - c.y) < 60) {
                player.inCar = true;
                player.car = c;
                if(currentMission === 1) nextMission();
            }
        });
    }
}

function talkToNPC() {
    npcs.forEach(n => {
        if(Math.hypot(player.x - n.x, player.y - n.y) < 50) {
            const box = document.getElementById('dialog');
            box.innerText = n.dialog;
            box.style.display = 'block';
            setTimeout(() => box.style.display = 'none', 3000);
            if(currentMission === 0) nextMission();
        }
    });
}

function nextMission() {
    currentMission++;
    const m = document.getElementById('mission');
    if(currentMission === 1) m.innerText = "GÃ–REV: SarÄ± arabayÄ± Ã§al!";
    if(currentMission === 2) m.innerText = "GÃ–REV: Arabayla uzaklaÅŸ (SÃ¼rÃ¼ÅŸ Testi)!";
}

function shoot() {
    let angle = Math.atan2(mouse.y - player.y, mouse.x - player.x);
    bullets.push({ x: player.x, y: player.y, vx: Math.cos(angle)*15, vy: Math.sin(angle)*15 });
}

// --- FÄ°ZÄ°K VE Ã‡Ä°ZÄ°M ---
function drawPlayer(x, y, angle, color) {
    ctx.save();
    ctx.translate(x, y);
    ctx.rotate(angle);
    // VÃ¼cut
    ctx.fillStyle = color;
    ctx.fillRect(-15, -15, 30, 30);
    // GÃ¶zler (Modelleme)
    ctx.fillStyle = "white";
    ctx.fillRect(5, -10, 5, 5);
    ctx.fillRect(5, 5, 5, 5);
    ctx.restore();
}

function drawCar(car) {
    ctx.save();
    ctx.translate(car.x, car.y);
    ctx.rotate(car.angle);
    // GÃ¶vde
    ctx.fillStyle = car.color;
    ctx.fillRect(-40, -25, 80, 50);
    // Camlar
    ctx.fillStyle = "rgba(0,0,0,0.5)";
    ctx.fillRect(-10, -20, 30, 40);
    // Farlar
    ctx.fillStyle = "yellow";
    ctx.fillRect(35, -20, 5, 10);
    ctx.fillRect(35, 10, 5, 10);
    ctx.restore();
}

function update() {
    if(player.inCar) {
        // ARABA FÄ°ZÄ°ÄÄ°
        let c = player.car;
        if(keys['KeyW']) c.speed += 0.2;
        if(keys['KeyS']) c.speed -= 0.1;
        c.speed *= 0.98; // SÃ¼rtÃ¼nme
        if(keys['KeyA']) c.angle -= 0.05 * (c.speed/5);
        if(keys['KeyD']) c.angle += 0.05 * (c.speed/5);
        c.x += Math.cos(c.angle) * c.speed;
        c.y += Math.sin(c.angle) * c.speed;
        player.x = c.x; player.y = c.y; player.angle = c.angle;
    } else {
        // YAYA HAREKETÄ°
        if(keys['KeyW']) player.y -= player.maxSpeed;
        if(keys['KeyS']) player.y += player.maxSpeed;
        if(keys['KeyA']) player.x -= player.maxSpeed;
        if(keys['KeyD']) player.x += player.maxSpeed;
        player.angle = Math.atan2(mouse.y - player.y, mouse.x - player.x);
    }

    camera.x = player.x - canvas.width/2;
    camera.y = player.y - canvas.height/2;

    bullets.forEach((b, i) => {
        b.x += b.vx; b.y += b.vy;
        if(Math.abs(b.x) > 5000) bullets.splice(i, 1);
    });
}

function loop() {
    ctx.setTransform(1,0,0,1,0,0);
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.translate(-camera.x, -camera.y);

    // Yer IzgarasÄ± (Harita hissi iÃ§in)
    ctx.strokeStyle = "#333";
    for(let i=0; i<3000; i+=100) {
        ctx.beginPath(); ctx.moveTo(i, 0); ctx.lineTo(i, 3000); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(0, i); ctx.lineTo(3000, i); ctx.stroke();
    }

    buildings.forEach(b => { ctx.fillStyle = b.color; ctx.fillRect(b.x, b.y, b.w, b.h); });
    cars.forEach(drawCar);
    npcs.forEach(n => drawPlayer(n.x, n.y, n.angle, n.color));
    
    // Mermiler
    ctx.fillStyle = "yellow";
    bullets.forEach(b => ctx.fillRect(b.x, b.y, 10, 4));

    if(!player.inCar) drawPlayer(player.x, player.y, player.angle, "#3498db");

    update();
    requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
