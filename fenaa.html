<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tuna Galeri: Pro Drive & Radio Fix</title>
<style>
    :root { --bg: #050505; --card: #111; --gold: #ffd700; --red: #ff4d4d; --green: #2ecc71; --blue: #3498db; }
    body { margin: 0; background: var(--bg); color: #fff; font-family: sans-serif; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
    .top-bar { background: #000; padding: 12px; display: flex; justify-content: space-around; border-bottom: 2px solid #222; z-index: 100; }
    .bar-wrap { width: 60px; height: 8px; background: #333; border-radius: 4px; display: inline-block; }
    .bar-fill { height: 100%; transition: 0.4s; border-radius: 4px; }
    .game-container { flex: 1; display: grid; grid-template-columns: 220px 1fr 280px; gap: 10px; padding: 10px; position: relative; }
    .nav-menu { display: flex; flex-direction: column; gap: 8px; z-index: 10; }
    .nav-btn { background: var(--card); border: 1px solid #333; color: #fff; padding: 15px; border-radius: 10px; cursor: pointer; text-align: left; }
    .nav-btn.active { background: var(--blue); border-color: #fff; }
    .stage { background: #000; border-radius: 20px; border: 1px solid #333; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; }
    
    /* DRIVE UI */
    #drive-ui { position: absolute; top: 20px; width: 100%; text-align: center; display: none; pointer-events: none; z-index: 50; }
    #radio-ctrl { position: absolute; bottom: 20px; right: 20px; z-index: 100; display: none; }
    
    /* SEÃ‡Ä°M EKRANI */
    #drive-setup { position: absolute; background: rgba(0,0,0,0.95); padding: 30px; border-radius: 20px; border: 2px solid var(--gold); text-align: center; display: none; z-index: 60; width: 320px; }
    .sel-group { display: flex; gap: 5px; margin-bottom: 15px; }
    .active-sel { border: 2px solid #fff !important; transform: scale(1.05); }

    .sidebar { background: var(--card); border-radius: 20px; padding: 20px; border: 1px solid #333; z-index: 10; display: flex; flex-direction: column; gap: 10px; }
    .car-card { background: #000; height: 140px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 5em; border: 2px dashed #444; }
    .btn { border: none; padding: 12px; border-radius: 8px; font-weight: bold; cursor: pointer; width: 100%; margin-bottom: 8px; font-size: 14px; transition: 0.2s; }
    .btn-green { background: var(--green); color: #000; }
    .btn-blue { background: var(--blue); color: #fff; }
    .btn-gold { background: var(--gold); color: #000; }
    .btn-red { background: var(--red); color: #fff; }
    #three-canvas { width: 100%; height: 100%; display: none; }
</style>
</head>
<body>

    <audio id="game-radio" loop>
        <source src="https://stream.zeno.fm/f378v6p6n98uv" type="audio/mpeg">
    </audio>

    <div class="top-bar">
        <div>ğŸ’° <span id="money-val" style="color:var(--green)">75,000</span></div>
        <div>ğŸ• <div class="bar-wrap"><div id="hunger-bar" class="bar-fill" style="background:var(--red); width:20%"></div></div></div>
        <div>ğŸ•Œ <div class="bar-wrap"><div id="faith-bar" class="bar-fill" style="background:var(--green); width:50%"></div></div></div>
        <div style="color:var(--blue)">ğŸ“… <span id="day-val">Pzt</span></div>
    </div>

    <div class="game-container">
        <div class="nav-menu">
            <button class="nav-btn active" id="m-galeri" onclick="loc('galeri')">ğŸ¢ GALERÄ°</button>
            <button class="nav-btn" id="m-mahalle" onclick="loc('mahalle')">ğŸ˜ï¸ MAHALLE</button>
            <button class="nav-btn" id="m-sanayi" onclick="loc('sanayi')">ğŸ”§ SANAYÄ°</button>
            <button class="btn btn-red" style="margin-top:auto" onclick="nextDay()">ğŸŒ™ GÃœNÃœ BÄ°TÄ°R</button>
        </div>

        <div class="stage" id="stage-area">
            <div id="drive-ui">
                <div id="timer-display" style="font-size:28px; color:var(--red); font-weight:bold;">00:00</div>
                <p>Puan: <span id="drive-score">0</span> | Mod: <span id="speed-label" style="color:var(--gold)">SeÃ§ilmedi</span></p>
            </div>

            <div id="radio-ctrl">
                <button class="btn btn-gold" onclick="toggleRadio()" style="width: auto; padding: 10px 20px; border: 2px solid #fff;">ğŸ“» RADYO: <span id="rad-status">KAPALI</span></button>
            </div>

            <div id="drive-setup">
                <h3 style="color:var(--gold); margin-top:0;">TEST SÃœRÃœÅÃœ AYARLARI</h3>
                <p style="margin:5px 0">SÃ¼re SeÃ§:</p>
                <div class="sel-group">
                    <button id="t-1" class="btn btn-blue" onclick="setDur(1, this)">1 Dk</button>
                    <button id="t-2" class="btn btn-blue" onclick="setDur(2, this)">2 Dk</button>
                    <button id="t-5" class="btn btn-blue" onclick="setDur(5, this)">5 Dk</button>
                </div>
                <p style="margin:5px 0">HÄ±z SeÃ§:</p>
                <div class="sel-group">
                    <button id="s-05" class="btn btn-green" onclick="setSpd(0.5, this, 'YavaÅŸ')">YAVAÅ</button>
                    <button id="s-12" class="btn btn-gold" onclick="setSpd(1.2, this, 'Orta')">ORTA</button>
                    <button id="s-22" class="btn btn-red" onclick="setSpd(2.2, this, 'HÄ±zlÄ±')">HIZLI</button>
                </div>
                <hr style="border:0; border-top:1px solid #333; margin:15px 0">
                <button class="btn btn-green" style="font-size:18px; padding:15px;" onclick="startEngine()">KONTAÄI Ã‡EVÄ°R!</button>
                <button class="btn btn-red" style="background:none; border:1px solid #444" onclick="cancelSetup()">VAZGEÃ‡</button>
            </div>
            
            <div id="npc-view" style="text-align:center">
                <div id="npc-avatar" style="font-size: 6em;">ğŸ¤µ</div>
                <h3 id="npc-name">Mahmut</h3>
                <p id="npc-text">"HÄ±zÄ±nÄ± ayarla, asfaltÄ± aÄŸlat kral."</p>
                <div id="action-btns" style="width: 250px; margin: 0 auto;"></div>
            </div>

            <canvas id="three-canvas"></canvas>
        </div>

        <div class="sidebar">
            <div class="car-card" id="car-img">ğŸš—</div>
            <h3 id="car-title" style="text-align:center; margin:5px 0">TofaÅŸ Åahin</h3>
            <p id="car-info" style="text-align:center; color:#888;">DeÄŸer: â‚º157.500</p>
            <div id="side-ctrl">
                <button class="btn btn-gold" onclick="openDriveSetup()">ğŸ 3D TEST SÃœRÃœÅÃœ</button>
            </div>
        </div>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
    const cars = [{n:"TofaÅŸ Åahin", p:250000, i:"ğŸš—", c:0xffffff}, {n:"BMW M4", p:6000000, i:"ğŸï¸", c:0x0033ff}, {n:"G63", p:16000000, i:"ğŸšœ", c:0x111111}];
    let state = { money: 75000, hunger: 20, faith: 50, day: 0, car: {n:"TofaÅŸ Åahin", p:157500, i:"ğŸš—", c:0xffffff}, loc: 'galeri', score: 0 };
    let driveActive = false, driveTimer = 0, driveInterval = null;
    let selectedDuration = 1, selectedSpeed = 0.5;

    // --- 3D SETUP ---
    const canvas = document.getElementById('three-canvas');
    const scene = new THREE.Scene();
    scene.fog = new THREE.Fog(0x000000, 1, 80);
    const camera = new THREE.PerspectiveCamera(75, 2, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas, antialias: true });

    const roadGroup = new THREE.Group();
    const road = new THREE.Mesh(new THREE.PlaneGeometry(15, 300), new THREE.MeshStandardMaterial({ color: 0x151515 }));
    road.rotation.x = -Math.PI/2;
    roadGroup.add(road);
    scene.add(roadGroup);

    const lines = [];
    for(let i=0; i<30; i++) {
        let l = new THREE.Mesh(new THREE.PlaneGeometry(0.3, 6), new THREE.MeshBasicMaterial({ color: 0xffffff }));
        l.rotation.x = -Math.PI/2; l.position.set(0, 0.05, -i*15);
        roadGroup.add(l); lines.push(l);
    }

    const lamps = [];
    function createLamp(z) {
        const g = new THREE.Group();
        const pole = new THREE.Mesh(new THREE.CylinderGeometry(0.1, 0.1, 8), new THREE.MeshStandardMaterial({color:0x333333}));
        pole.position.set(-7.5, 4, z);
        const bulb = new THREE.PointLight(0xffaa00, 15, 25); bulb.position.set(-6, 7.5, z);
        g.add(pole, bulb); scene.add(g); lamps.push(g);
    }
    for(let i=0; i<10; i++) createLamp(-i*40);

    const playerCar = new THREE.Group();
    const hL = new THREE.SpotLight(0xffffff, 50, 40, Math.PI/6, 0.5);
    const hR = new THREE.SpotLight(0xffffff, 50, 40, Math.PI/6, 0.5);
    function buildCar(color) {
        playerCar.clear();
        const body = new THREE.Mesh(new THREE.BoxGeometry(1.6, 0.6, 3.5), new THREE.MeshStandardMaterial({color}));
        body.position.y = 0.5;
        hL.position.set(0.6, 0.6, -1.7); hL.target.position.set(0.6, 0, -20);
        hR.position.set(-0.6, 0.6, -1.7); hR.target.position.set(-0.6, 0, -20);
        playerCar.add(body, hL, hR, hL.target, hR.target);
    }
    scene.add(playerCar);
    scene.add(new THREE.AmbientLight(0xffffff, 0.1));
    camera.position.set(0, 6, 11); camera.lookAt(0, 0, -3);

    let enemies = [];
    function addEnemy() {
        const g = new THREE.Group();
        const eBody = new THREE.Mesh(new THREE.BoxGeometry(1.6, 0.7, 3), new THREE.MeshStandardMaterial({color: 0x333333}));
        eBody.position.y = 0.5;
        const s = new THREE.Mesh(new THREE.BoxGeometry(0.4, 0.2, 0.1), new THREE.MeshBasicMaterial({color: 0xff0000}));
        s.position.set(0.5, 0.6, 1.5); g.add(eBody, s);
        g.position.set((Math.random()-0.5)*12, 0, -120);
        scene.add(g); enemies.push(g);
    }

    // --- LOGIC ---
    function setDur(m, btn) { 
        selectedDuration = m; 
        document.querySelectorAll('.sel-group .btn-blue').forEach(b => b.classList.remove('active-sel'));
        btn.classList.add('active-sel');
    }
    function setSpd(s, btn, label) { 
        selectedSpeed = s; 
        document.getElementById('speed-label').innerText = label;
        document.querySelectorAll('.sel-group .btn:not(.btn-blue)').forEach(b => b.classList.remove('active-sel'));
        btn.classList.add('active-sel');
    }

    function toggleRadio() {
        const r = document.getElementById('game-radio');
        const s = document.getElementById('rad-status');
        if(r.paused) { r.play(); s.innerText = "AÃ‡IK"; } else { r.pause(); s.innerText = "KAPALI"; }
    }

    function openDriveSetup() { document.getElementById('drive-setup').style.display = "block"; }
    function cancelSetup() { document.getElementById('drive-setup').style.display = "none"; }

    function startEngine() {
        document.getElementById('drive-setup').style.display = "none";
        driveActive = true; state.score = 0; driveTimer = selectedDuration * 60;
        document.getElementById('npc-view').style.display = "none";
        canvas.style.display = "block";
        document.getElementById('drive-ui').style.display = "block";
        document.getElementById('radio-ctrl').style.display = "block";
        buildCar(state.car.c);
        driveInterval = setInterval(() => {
            driveTimer--;
            let m = Math.floor(driveTimer / 60), s = driveTimer % 60;
            document.getElementById('timer-display').innerText = `Kalan: ${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
            if(driveTimer <= 0) endDrive(false);
        }, 1000);
        animateDrive();
    }

    function animateDrive() {
        if(!driveActive) return;
        requestAnimationFrame(animateDrive);
        const s = selectedSpeed;
        lines.forEach(l => { l.position.z += s * 8; if(l.position.z > 20) l.position.z = -250; });
        lamps.forEach(l => { l.position.z += s * 8; if(l.position.z > 30) l.position.z = -250; });
        if(Math.random() < 0.02 * (s*2)) addEnemy();
        enemies.forEach((e, i) => {
            e.position.z += s * 10;
            if(Math.abs(e.position.z - playerCar.position.z) < 3.2 && Math.abs(e.position.x - playerCar.position.x) < 1.6) endDrive(true);
            if(e.position.z > 25) { scene.remove(e); enemies.splice(i, 1); state.score += Math.floor(1000 * s); }
        });
        document.getElementById('drive-score').innerText = state.score.toLocaleString();
        renderer.render(scene, camera);
    }

    function endDrive(crash) {
        driveActive = false; clearInterval(driveInterval);
        document.getElementById('game-radio').pause();
        if(crash) { state.car.p = Math.floor(state.car.p * 0.7); alert("KAZA YAPTIN! ArabanÄ±n deÄŸeri %30 dÃ¼ÅŸtÃ¼."); }
        else { state.car.p += state.score; alert("SÃ¼re bitti! Araba ÅŸimdi daha deÄŸerli."); }
        enemies.forEach(e => scene.remove(e)); enemies = [];
        canvas.style.display = "none"; document.getElementById('drive-ui').style.display = "none";
        document.getElementById('radio-ctrl').style.display = "none";
        document.getElementById('npc-view').style.display = "block"; updateUI();
    }

    window.addEventListener('keydown', (e) => {
        if(!driveActive) return;
        if(e.key === 'a' || e.key === 'ArrowLeft') playerCar.position.x = Math.max(-6, playerCar.position.x - 0.7);
        if(e.key === 'd' || e.key === 'ArrowRight') playerCar.position.x = Math.min(6, playerCar.position.x + 0.7);
    });

    function loc(l) {
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('m-'+l).classList.add('active');
        const area = document.getElementById('action-btns'); area.innerHTML = "";
        if(l==='galeri') setNPC("ğŸ¤µ", "Mahmut", "Radyoda gÃ¼zel parÃ§a var, sÃ¼rÃ¼ÅŸe geÃ§elim mi?");
        if(l==='mahalle') { setNPC("ğŸ‘³", "HacÄ± Abi", "YavaÅŸ sÃ¼r evlat."); area.innerHTML = `<button class="btn btn-gold" onclick="pray()">ğŸ•Œ NAMAZ KIL</button>`; }
        updateUI();
    }
    function updateUI() {
        document.getElementById('money-val').innerText = state.money.toLocaleString();
        if(state.car) {
            document.getElementById('car-title').innerText = state.car.n;
            document.getElementById('car-info').innerText = "DeÄŸer: â‚º" + state.car.p.toLocaleString();
        }
    }
    function setNPC(a,n,t) { document.getElementById('npc-avatar').innerText=a; document.getElementById('npc-name').innerText=n; document.getElementById('npc-text').innerText=`"${t}"`; }
    function nextDay() { state.day++; if(state.day>6) state.day=0; loc('galeri'); }
    updateUI();
</script>
</body>
</html>
