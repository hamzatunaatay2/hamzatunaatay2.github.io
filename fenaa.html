<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>Mini 3D Araba Sürme | Resimli Versiyon</title>
<style>
    body { margin: 0; overflow: hidden; background: #0b0b0b; color: white; font-family: sans-serif; }
    #scoreBoard { position: absolute; top: 10px; left: 10px; font-size: 18px; z-index: 10; background: rgba(0,0,0,0.5); padding: 5px 10px; border-radius: 4px; }
    #info { position: absolute; bottom: 10px; left: 10px; color: gray; font-size: 12px; }
</style>
</head>
<body>

<div id="scoreBoard">Skor: <span id="score">0</span></div>
<div id="info">Araba resmi yüklenmezse (siyah olursa), "Live Server" kullanın veya internet bağlantınızı kontrol edin.</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.154.0/build/three.min.js"></script>
<script>
// --- SAHNE KURULUMU ---
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87CEEB); // Gökyüzü mavisi yaptık (daha ferah)
scene.fog = new THREE.Fog(0x87CEEB, 10, 50); // Ufuk çizgisi için sis efekti

// --- KAMERA ---
const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
camera.position.set(0, 3, 6);

// --- RENDERER ---
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.shadowMap.enabled = true; // Gölgeleri açalım
document.body.appendChild(renderer.domElement);

// --- IŞIKLAR ---
const light = new THREE.DirectionalLight(0xffffff, 1.2);
light.position.set(10, 20, 10);
light.castShadow = true;
scene.add(light);
const ambient = new THREE.AmbientLight(0x404040, 0.6);
scene.add(ambient);

// --- DOKU YÜKLEYİCİ (FOTOĞRAF İÇİN) ---
const textureLoader = new THREE.TextureLoader();

// --- YOL ---
const roadGeometry = new THREE.PlaneGeometry(14, 200);
const roadMaterial = new THREE.MeshStandardMaterial({ color: 0x333333 });
const road = new THREE.Mesh(roadGeometry, roadMaterial);
road.rotation.x = -Math.PI / 2;
road.receiveShadow = true;
scene.add(road);

// --- ARABA (FOTOĞRAFLI) ---
// Not: Aşağıdaki URL'yi kendi araba resminin linkiyle değiştirebilirsin.
// Kare veya dikdörtgen bir "texture" (doku) görseli en iyi sonucu verir.
const carTextureUrl = 'https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/crate.gif'; 
// (Şimdilik örnek olarak ahşap kutu dokusu koydum, araba yan/üst görünüşü bulursan buraya yapıştır)

const carTexture = textureLoader.load(carTextureUrl);
const carGeometry = new THREE.BoxGeometry(1.5, 0.8, 2.5); // Araba boyutunu biraz büyüttüm
const carMaterial = new THREE.MeshStandardMaterial({ 
    map: carTexture, // FOTOĞRAFI BURADA ATIYORUZ
    color: 0xffffff // Resmin rengini bozmamak için beyaz taban
});

const car = new THREE.Mesh(carGeometry, carMaterial);
car.position.y = 0.4;
car.castShadow = true; // Gölge düşürsün
scene.add(car);

// --- PALMİYELER / AĞAÇLAR ---
const palms = [];
const trunkMat = new THREE.MeshStandardMaterial({ color: 0x8B4513 }); // Kahverengi gövde
const leafMat = new THREE.MeshStandardMaterial({ color: 0x228B22 });  // Yeşil yaprak

for(let i = 0; i < 20; i++){
  const group = new THREE.Group();

  // Gövde
  const trunkGeo = new THREE.CylinderGeometry(0.2, 0.3, 2, 8);
  const trunk = new THREE.Mesh(trunkGeo, trunkMat);
  trunk.position.y = 1;
  trunk.castShadow = true;
  group.add(trunk);

  // Yapraklar (Basit koni)
  const leavesGeo = new THREE.ConeGeometry(1.2, 2, 8);
  const leaves = new THREE.Mesh(leavesGeo, leafMat);
  leaves.position.y = 2.5;
  group.add(leaves);

  // Konumlandırma
  group.position.x = (Math.random() < 0.5 ? -1 : 1) * (Math.random() * 5 + 4);
  group.position.z = -i * 15; // Biraz daha aralıklı
  
  scene.add(group);
  palms.push(group);
}

// --- ENGELLER ---
const obstacles = [];
function spawnObstacle(){
  const obsGeo = new THREE.BoxGeometry(1, 1, 1);
  const obsMat = new THREE.MeshStandardMaterial({ color: 0xff0000 }); // Kırmızı engeller
  const obs = new THREE.Mesh(obsGeo, obsMat);
  obs.position.y = 0.5;
  obs.position.z = -60; // Daha uzaktan gelsin
  obs.position.x = (Math.random() - 0.5) * 10; // Yol genişliğine göre
  obs.castShadow = true;
  scene.add(obs);
  obstacles.push(obs);
}
// Engel gelme sıklığı
setInterval(spawnObstacle, 1500);

// --- OYUN DEĞİŞKENLERİ ---
let score = 0;
let gameSpeed = 15; // Hız değişkeni
const scoreEl = document.getElementById("score");

// --- KLAVYE KONTROLLERİ ---
const keys = {};
document.addEventListener("keydown", e => { keys[e.key.toLowerCase()] = true; });
document.addEventListener("keyup", e => { keys[e.key.toLowerCase()] = false; });

// --- ANİMASYON DÖNGÜSÜ ---
const clock = new THREE.Clock();

function animate(){
  requestAnimationFrame(animate);
  const delta = clock.getDelta();
  
  // 1. ARABA HAREKETİ
  if(keys.a || keys.arrowleft) car.position.x -= 15 * delta;
  if(keys.d || keys.arrowright) car.position.x += 15 * delta;
  
  // Sınırlandırma (Yoldan çıkmasın)
  car.position.x = Math.max(-6, Math.min(6, car.position.x));
  
  // Araba hafif sallanma efekti (motor titremesi gibi)
  car.rotation.z = (keys.a || keys.arrowleft) ? 0.1 : (keys.d || keys.arrowright) ? -0.1 : 0;


  palms.forEach(p => {
      p.position.z += gameSpeed * delta;
      if(p.position.z > 10) p.position.z = -200; // Başa sar
  });

  // Engeller
  for(let i = obstacles.length - 1; i >= 0; i--){
    obstacles[i].position.z += gameSpeed * delta;

    // Engel geçti mi?
    if(obstacles[i].position.z > 10){
      scene.remove(obstacles[i]);
      obstacles.splice(i, 1);
      score++;
      scoreEl.textContent = score;
      
      // Oyun hızlansın
      if(score % 5 === 0) gameSpeed += 1; 
    }
    
    // ÇARPIŞMA KONTROLÜ
    // Basit mesafe kontrolü
    if(obstacles[i]){
        const distZ = Math.abs(obstacles[i].position.z - car.position.z);
        const distX = Math.abs(obstacles[i].position.x - car.position.x);
        
        if(distZ < 1.5 && distX < 1.2){
            alert("OYUN BİTTİ! Skorun: " + score);
            location.reload();
        }
    }
  }

  // 3. KAMERA TAKİBİ (Daha yumuşak)
  camera.position.x = car.position.x * 0.3; // Hafifçe sağa sola yatsın
  camera.lookAt(car.position.x, 0, 0); // Arabaya baksın

  renderer.render(scene, camera);
}

window.addEventListener("resize", () => {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});

animate();
</script>
</body>
</html>
